# DevOps ê°œì„  ì‘ì—… ì™„ë£Œ ë³´ê³ ì„œ

**ì‘ì—… ì¼ì‹œ**: 2026-01-03  
**ì‘ì—…ì**: DevOps Team  
**í”„ë¡œì íŠ¸**: Cabinet Backend

---

## ğŸ“‹ ì‘ì—… ê°œìš”

ì´ **3ê°€ì§€ ì£¼ìš” ë¬¸ì œ**ë¥¼ í•´ê²°í•˜ê³  ì‹œìŠ¤í…œ ì•ˆì •ì„±ì„ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. Prometheus ì„¤ì • ì˜¤ë¥˜ ìˆ˜ì •

#### ğŸ”´ ë¬¸ì œì 
```yaml
# prometheus/prometheus.yml (ìˆ˜ì • ì „)
- targets: ['host.docker.internal:8080']
```
- `host.docker.internal`ì€ Docker Desktopì—ì„œë§Œ ì‘ë™
- ì‹¤ì œ ì„œë²„ ë°°í¬ ì‹œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë¶ˆê°€ëŠ¥
- Docker ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€ í†µì‹  ì‚¬ìš© ë¶ˆê°€

#### âœ… í•´ê²°
```yaml
# prometheus/prometheus.yml (ìˆ˜ì • í›„)
- targets: ['backend:8080']
```

**ë³€ê²½ ì‚¬í•­:**
- Docker Compose ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€ ì„œë¹„ìŠ¤ëª… ì‚¬ìš©
- ëª¨ë“  í™˜ê²½ì—ì„œ ë™ì‘ ê°€ëŠ¥
- ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬ ë° ë³´ì•ˆ ê°•í™”

**íŒŒì¼ ìœ„ì¹˜:** `prometheus/prometheus.yml`

---

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì „ëµ êµ¬ì¶•

#### ğŸ”´ ë¬¸ì œì 
- ë°±ì—… ì‹œìŠ¤í…œ ì „ë¬´
- ë°ì´í„° ì†ì‹¤ ì‹œ ë³µêµ¬ ë¶ˆê°€ëŠ¥
- ì •ê¸° ë°±ì—… í”„ë¡œì„¸ìŠ¤ ë¶€ì¬

#### âœ… í•´ê²°ì±…

**2.1. ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ ìƒì„±**
```bash
scripts/backup_db.sh
```

**ê¸°ëŠ¥:**
- ìë™ íƒ€ì„ìŠ¤íƒ¬í”„ ë°±ì—… íŒŒì¼ ìƒì„±
- gzip ì••ì¶•ìœ¼ë¡œ ì €ì¥ ê³µê°„ ì ˆì•½
- 7ì¼ ì´ìƒ ëœ ë°±ì—… ìë™ ì‚­ì œ
- íŠ¸ëœì­ì…˜ ì¼ê´€ì„± ë³´ì¥ (`--single-transaction`)
- íŠ¸ë¦¬ê±°, í”„ë¡œì‹œì €, ì´ë²¤íŠ¸ í¬í•¨

**ì‚¬ìš©ë²•:**
```bash
# ë°±ì—… ì‹¤í–‰
./scripts/backup_db.sh

# ë°±ì—… ê²°ê³¼ ì˜ˆì‹œ
ğŸ“¦ Starting database backup...
ğŸ“… Timestamp: 20260103_143052
âœ… Backup completed: ./backups/database/cabinet_backup_20260103_143052.sql.gz
ğŸ“Š Backup size: 2.3M
```

**2.2. ë³µì› ìŠ¤í¬ë¦½íŠ¸ ìƒì„±**
```bash
scripts/restore_db.sh
```

**ê¸°ëŠ¥:**
- ë°±ì—… íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
- ì•ˆì „ í™•ì¸ í”„ë¡¬í”„íŠ¸
- ìë™ ì••ì¶• í•´ì œ ë° ë³µì›

**ì‚¬ìš©ë²•:**
```bash
# ë³µì› ì‹¤í–‰
./scripts/restore_db.sh backups/database/cabinet_backup_20260103_143052.sql.gz
```

**2.3. Crontab ìë™ ë°±ì—… ì„¤ì • (ê¶Œì¥)**

ë§¤ì¼ ìƒˆë²½ 3ì‹œ ìë™ ë°±ì—…:
```bash
# crontab í¸ì§‘
crontab -e

# ë‹¤ìŒ ì¤„ ì¶”ê°€
0 3 * * * cd /path/to/ft_cabinet_BE && ./scripts/backup_db.sh >> logs/backup.log 2>&1
```

**íŒŒì¼ ìœ„ì¹˜:**
- `scripts/backup_db.sh` - ë°±ì—… ìŠ¤í¬ë¦½íŠ¸
- `scripts/restore_db.sh` - ë³µì› ìŠ¤í¬ë¦½íŠ¸
- `backups/database/` - ë°±ì—… ì €ì¥ ë””ë ‰í† ë¦¬ (ìë™ ìƒì„±)

---

### 3. ë¡œê·¸ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•

#### ğŸ”´ ë¬¸ì œì 
- ì»¨í…Œì´ë„ˆ ë¡œê·¸ê°€ ë¬´í•œì • ì¦ê°€
- ë””ìŠ¤í¬ í’€ ìœ„í—˜
- ë¡œê·¸ ë¡œí…Œì´ì…˜ ë¶€ì¬

#### âœ… í•´ê²°ì±…

**docker-compose.yaml ì „ì²´ ì»¨í…Œì´ë„ˆì— ë¡œê·¸ ë¡œí…Œì´ì…˜ ì ìš©:**

```yaml
logging:
  driver: "json-file"
  options:
    max-size: "10m"      # ë¡œê·¸ íŒŒì¼ ìµœëŒ€ í¬ê¸°
    max-file: "3"        # ë³´ê´€í•  ë¡œê·¸ íŒŒì¼ ê°œìˆ˜
```

**ì ìš© ì»¨í…Œì´ë„ˆ:**
- âœ… `backend` (cabi_backend)
- âœ… `mariadb` (cabi_db)
- âœ… `redis` (cabi_redis)
- âœ… `nginx` (cabi_nginx)

**íš¨ê³¼:**
- ê° ì»¨í…Œì´ë„ˆë‹¹ ìµœëŒ€ 30MB ë¡œê·¸ ë³´ê´€ (10MB Ã— 3ê°œ)
- ë””ìŠ¤í¬ ê³µê°„ ë¬´í•œ ì¦ê°€ ë°©ì§€
- ìë™ ë¡œê·¸ ë¡œí…Œì´ì…˜
- ì˜¤ë˜ëœ ë¡œê·¸ ìë™ ì‚­ì œ

**ë¡œê·¸ í™•ì¸ ë°©ë²•:**
```bash
# ìµœê·¼ ë¡œê·¸ í™•ì¸
docker logs cabi_backend --tail 100

# ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°
docker logs -f cabi_backend

# ëª¨ë“  ë¡œê·¸ í™•ì¸ (ìµœëŒ€ 30MB)
docker logs cabi_backend
```

**íŒŒì¼ ìœ„ì¹˜:** `docker-compose.yaml`

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

```
ft_cabinet_BE/
â”œâ”€â”€ prometheus/
â”‚   â””â”€â”€ prometheus.yml                    # âœï¸  ìˆ˜ì •
â”œâ”€â”€ docker-compose.yaml                   # âœï¸  ìˆ˜ì •
â”œâ”€â”€ .gitignore                            # âœï¸  ìˆ˜ì • (backups/ ì¶”ê°€)
â”œâ”€â”€ scripts/                              # ğŸ†• ì‹ ê·œ
â”‚   â”œâ”€â”€ backup_db.sh                      # ğŸ†• ì‹ ê·œ
â”‚   â””â”€â”€ restore_db.sh                     # ğŸ†• ì‹ ê·œ
â””â”€â”€ backups/                              # ğŸ†• ì‹ ê·œ (ìë™ ìƒì„±)
    â””â”€â”€ database/
```

---

## ğŸš€ ì ìš© ë°©ë²•

### 1ë‹¨ê³„: ë³€ê²½ì‚¬í•­ ì ìš©
```bash
# í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd /path/to/ft_cabinet_BE

# Docker Compose ì¬ì‹œì‘ (ë¡œê·¸ ì„¤ì • ì ìš©)
docker-compose down
docker-compose up -d
```

### 2ë‹¨ê³„: Prometheus í™•ì¸
```bash
# Prometheus ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose restart prometheus

# ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™•ì¸
docker logs cabi_prometheus
```

### 3ë‹¨ê³„: ë°±ì—… í…ŒìŠ¤íŠ¸
```bash
# ì²« ë°±ì—… ì‹¤í–‰
./scripts/backup_db.sh

# ë°±ì—… íŒŒì¼ í™•ì¸
ls -lh backups/database/
```

### 4ë‹¨ê³„: ë¡œê·¸ í™•ì¸
```bash
# ê° ì»¨í…Œì´ë„ˆ ë¡œê·¸ í¬ê¸° í™•ì¸
docker inspect cabi_backend | grep LogPath
```

---

## ğŸ“Š ê°œì„  íš¨ê³¼

| í•­ëª© | ê°œì„  ì „ | ê°œì„  í›„ |
|------|---------|---------|
| **Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘** | âŒ ë¶ˆê°€ëŠ¥ (ì„œë²„ ë°°í¬ ì‹œ) | âœ… ì •ìƒ ì‘ë™ |
| **ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…** | âŒ ì—†ìŒ | âœ… ìë™í™” ê°€ëŠ¥ |
| **ë¡œê·¸ ê´€ë¦¬** | âŒ ë¬´ì œí•œ ì¦ê°€ | âœ… ìµœëŒ€ 30MB/ì»¨í…Œì´ë„ˆ |
| **ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰** | ğŸ”´ ìœ„í—˜ | ğŸŸ¢ ì•ˆì „ |
| **ì¬í•´ ë³µêµ¬** | âŒ ë¶ˆê°€ëŠ¥ | âœ… ê°€ëŠ¥ (7ì¼ ë°±ì—…) |

---

## ğŸ”” ì¶”ê°€ ê¶Œì¥ ì‚¬í•­

### 1. ìë™ ë°±ì—… ì„¤ì •
```bash
# Crontabì— ì¶”ê°€ (ë§¤ì¼ ìƒˆë²½ 3ì‹œ)
0 3 * * * cd /path/to/ft_cabinet_BE && ./scripts/backup_db.sh
```

### 2. ë°±ì—… ëª¨ë‹ˆí„°ë§
- ë°±ì—… ì„±ê³µ/ì‹¤íŒ¨ ì•Œë¦¼ (Slack/Email)
- ë°±ì—… íŒŒì¼ ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

### 3. ì›ê²© ë°±ì—…
- AWS S3, Google Cloud Storage ë“±ì— ë°±ì—… ì €ì¥
- ì¬í•´ ë³µêµ¬ ê³„íš (Disaster Recovery)

### 4. ë¡œê·¸ ìˆ˜ì§‘ ì‹œìŠ¤í…œ (ì„ íƒì‚¬í•­)
- ELK Stack (Elasticsearch, Logstash, Kibana)
- Loki + Grafana

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‘ì—… ì™„ë£Œ í™•ì¸:
- [x] Prometheus ì„¤ì • ìˆ˜ì •
- [x] ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ë° í…ŒìŠ¤íŠ¸
- [x] ë³µì› ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
- [x] ë¡œê·¸ ë¡œí…Œì´ì…˜ ì„¤ì •
- [x] .gitignore ì—…ë°ì´íŠ¸
- [x] Docker Compose ì¬ì‹œì‘
- [x] ë¬¸ì„œí™” ì‘ì„±

**ì‘ì„±ì¼**: 2026-01-03  
**ë²„ì „**: 1.0.0  
**ë‹¤ìŒ ì‘ì—…**: CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•, SSL/TLS ì ìš©

